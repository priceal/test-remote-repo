<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bare Rock Earth Energy Diagram with Albedo</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; font-family: Arial, sans-serif; }
  canvas { display: block; }
  .controls { margin-top: 16px; display: flex; flex-direction: column; gap: 10px; font-size: 14px; color: #333; width: 420px; }
  .ctrl-row { display: flex; align-items: center; gap: 10px; }
  .ctrl-row label { width: 140px; text-align: right; }
  .ctrl-row input[type=range] { flex: 1; }
  .ctrl-row span { width: 70px; font-variant-numeric: tabular-nums; }
  .info { margin-top: 8px; font-size: 13px; color: #666; text-align: center; }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="controls">
  <div class="ctrl-row">
    <label for="solar">Incident Solar:</label>
    <input type="range" id="solar" min="40" max="140" value="90">
    <span id="solarVal">90px</span>
  </div>
  <div class="ctrl-row">
    <label for="albedo">Albedo (α):</label>
    <input type="range" id="albedo" min="0" max="95" value="30">
    <span id="albedoVal">0.30</span>
  </div>
</div>
<div class="info" id="info"></div>
<script>
const cv = document.getElementById('c');
const ctx = cv.getContext('2d');
const solarSlider = document.getElementById('solar');
const albedoSlider = document.getElementById('albedo');
const solarVal = document.getElementById('solarVal');
const albedoVal = document.getElementById('albedoVal');
const infoEl = document.getElementById('info');

const W = 750, H = 520;
cv.width = W; cv.height = H;

function drawArrow(cx, topY, botY, w, color, label, down) {
  const headH = 28;
  const headW = w * 1.6;
  if (w < 4) return; // too thin to draw

  ctx.fillStyle = color;
  if (down) {
    // shaft
    ctx.fillRect(cx - w / 2, topY, w, botY - topY - headH);
    // head
    ctx.beginPath();
    ctx.moveTo(cx - headW / 2, botY - headH);
    ctx.lineTo(cx + headW / 2, botY - headH);
    ctx.lineTo(cx, botY);
    ctx.closePath();
    ctx.fill();
  } else {
    // shaft
    ctx.fillRect(cx - w / 2, topY + headH, w, botY - topY - headH);
    // head
    ctx.beginPath();
    ctx.moveTo(cx - headW / 2, topY + headH);
    ctx.lineTo(cx + headW / 2, topY + headH);
    ctx.lineTo(cx, topY);
    ctx.closePath();
    ctx.fill();
  }

  // label
  if (w > 12) {
    ctx.save();
    const midY = down ? (topY + botY - headH) / 2 : (topY + headH + botY) / 2;
    ctx.translate(cx, midY);
    ctx.rotate(-Math.PI / 2);
    ctx.fillStyle = '#fff';
    const fs = Math.max(10, Math.min(w * 0.38, 20));
    ctx.font = 'bold ' + fs + 'px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(label, 0, 0);
    ctx.restore();
  }
}

function draw() {
  const S = +solarSlider.value;
  const alpha = +albedoSlider.value / 100;
  solarVal.textContent = S + 'px';
  albedoVal.textContent = alpha.toFixed(2);

  // widths: incident = reflected + IR  (areas proportional to energy)
  // reflected width² ∝ α·S², IR width² ∝ (1-α)·S²
  // Using width directly proportional: reflected = α·S, IR = (1-α)·S
  // But we want width_incident = width_reflected + width_IR in terms of area (width).
  // Actually the constraint "width of incident = width of reflected + width of IR" literally:
  const refW = alpha * S;
  const irW = (1 - alpha) * S;
  // Check: refW + irW = S ✓

  ctx.clearRect(0, 0, W, H);

  // Earth
  const earthW = 580, earthH = earthW / 8;
  const ex = (W - earthW) / 2, ey = H - earthH - 30;
  ctx.fillStyle = '#6B4226';
  ctx.fillRect(ex, ey, earthW, earthH);
  ctx.fillStyle = '#fff';
  ctx.font = 'bold 18px Arial';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('EARTH (Bare Rock)', ex + earthW * 0.65, ey + earthH / 2);

  // Temperature display
  const T = 88.210658 * Math.pow(irW, 0.25);
  const C = T - 273.15;
  const F = C * 9 / 5 + 32;
  ctx.font = 'bold 15px Arial';
  ctx.fillStyle = '#fff';
  ctx.textAlign = 'left';
  ctx.fillText('T = ' + C.toFixed(1) + ' °C', ex + 12, ey + earthH / 2 - 8);
  ctx.fillText('T = ' + F.toFixed(1) + ' °F', ex + 12, ey + earthH / 2 + 12);
  ctx.textAlign = 'center';

  const topY = 50;

  // Position arrows: incident on left, reflected in center, IR on right
  const gap = 30;
  const totalW = S + refW + irW + gap * 2;
  const startX = (W - totalW) / 2;

  const incidentCx = startX + S / 2;
  const reflectedCx = startX + S + gap + refW / 2;
  const irCx = startX + S + gap + refW + gap + irW / 2;

  // Draw arrows
  drawArrow(incidentCx, topY, ey, S, '#F5C518', 'VISIBLE (In)', true);
  drawArrow(reflectedCx, topY, ey, refW, '#F5C518', 'VISIBLE (Ref)', false);
  drawArrow(irCx, topY, ey, irW, '#D32F2F', 'IR', false);

  // Top labels
  ctx.font = '12px Arial';
  ctx.textAlign = 'center';
  ctx.fillStyle = '#B8860B';
  ctx.fillText('Solar In', incidentCx, topY - 10);
  if (refW > 8) {
    ctx.fillStyle = '#B8860B';
    ctx.fillText('Reflected', reflectedCx, topY - 10);
  }
  ctx.fillStyle = '#D32F2F';
  if (irW > 8) ctx.fillText('Thermal Out', irCx, topY - 10);

  // Title
  ctx.fillStyle = '#333';
  ctx.font = 'bold 20px Arial';
  ctx.textAlign = 'center';
  ctx.fillText('Bare Rock Energy Balance with Albedo', W / 2, 28);

  // Info
  infoEl.textContent = `Incident width: ${S}  =  Reflected width: ${refW.toFixed(1)}  +  IR width: ${irW.toFixed(1)}  |  α = ${alpha.toFixed(2)}`;
}

solarSlider.addEventListener('input', draw);
albedoSlider.addEventListener('input', draw);
draw();
</script>
</body>
</html>
